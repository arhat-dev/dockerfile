include:
- renovate/dukkha.yaml

buildah:build:
- name: nix
  env@env: &env
  - APP=nix
  - VERSION=${NIX_VERSION}
  - DEFAULT_ROOTFS=alpine
  matrix: &matrix
    kernel:
    - linux
    rootfs:
    - alpine
    - debian
    arch:
    - amd64
    - arm64
    - x86
  file@env: nix/Dockerfile
  image_names@template|file|env|template: &image_names |-
    templates/image-names/include-rootfs-info/
    {{- /* multi-line join */ -}}
    env[APP:VERSION:DEFAULT_ROOTFS].yml
  extra_args@file|env|template: templates/image-extra-args/env[VERSION].yml

buildah:push:
- name: nix
  env@env: *env
  matrix: *matrix
  hooks:
    before:
    - task: buildah:login(ghcr)
  image_names@template|file|env|template: *image_names
